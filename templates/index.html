<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentiSec | Dinamik Tehdit Analiz Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 800px; margin-top: 50px; }
        .card { background-color: #1e1e1e; border: 1px solid #333; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-primary { background-color: #00bcd4; border: none; font-weight: bold; transition: 0.3s; }
        .btn-primary:hover { background-color: #0097a7; transform: translateY(-2px); }
        #resultArea { display: none; margin-top: 25px; padding: 20px; border-radius: 10px; background: #252525; }
        .risk-badge { font-size: 2rem; font-weight: 800; color: #ff5252; text-align: center; display: block; }
        .finding-item { padding: 10px; border-left: 4px solid #00bcd4; background: #2c2c2c; margin-bottom: 10px; border-radius: 0 5px 5px 0; }
        .loading { display: none; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card p-4">
        <h2 class="text-center mb-4" style="color: #00bcd4;">ğŸ›¡ï¸ SentiSec Tehdit Analizi</h2>
        
        <form id="analysisForm" enctype="multipart/form-data">
            <div class="mb-4">
                <label class="form-label">ÅÃ¼pheli GÃ¶rseli YÃ¼kle:</label>
                <input type="file" class="form-control bg-dark text-white border-secondary" name="image" id="imageInput" accept="image/*">
            </div>

            <div class="mb-4 text-center">
                <span>veya</span>
            </div>

            <div class="mb-4">
                <label class="form-label">Metni Buraya YapÄ±ÅŸtÄ±r:</label>
                <textarea class="form-control bg-dark text-white border-secondary" name="text" id="textInput" rows="4" placeholder="Analiz edilecek mesajÄ± yazÄ±n..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-100 p-3">ANALÄ°ZÄ° BAÅLAT</button>
        </form>

        <div class="loading mt-4">
            <div class="spinner-border text-info" role="status"></div>
            <p class="mt-2">Sistem analiz ediyor, lÃ¼tfen bekleyin...</p>
        </div>

        <div id="resultArea">
            <div class="text-center mb-3">
                <span class="text-secondary uppercase small">RÄ°SK SKORU</span>
                <span class="risk-badge" id="riskScore">%0</span>
            </div>
            <hr style="border-color: #444;">
            <h5>Tespit Edilen Bulgular:</h5>
            <div id="findingsList"></div>
            <div class="mt-3">
                <small class="text-secondary">Okunan Metin:</small>
                <p id="extractedText" class="small italic text-info"></p>
            </div>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('analysisForm');
    const loading = document.querySelector('.loading');
    const resultArea = document.getElementById('resultArea');

    form.onsubmit = async (e) => {
        e.preventDefault();
        
        // Ã–nceki sonuÃ§larÄ± temizle
        resultArea.style.display = 'none';
        loading.style.display = 'block';

        const formData = new FormData(form);

        try {
            const response = await fetch('/analiz', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            
            loading.style.display = 'none';
            resultArea.style.display = 'block';

            // Verileri YerleÅŸtir
            document.getElementById('riskScore').innerText = `%${data.risk}`;
            document.getElementById('extractedText').innerText = data.metin;
            
            const findingsList = document.getElementById('findingsList');
            findingsList.innerHTML = '';
            
            if (data.bulgular && data.bulgular.length > 0) {
                data.bulgular.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'finding-item';
                    div.innerText = item;
                    findingsList.appendChild(div);
                });
            } else {
                findingsList.innerHTML = '<p class="text-success">âš ï¸ Herhangi bir tehdit vektÃ¶rÃ¼ saptanamadÄ±.</p>';
            }

        } catch (error) {
            loading.style.display = 'none';
            alert('Sistem hatasÄ±: Backend baÄŸlantÄ±sÄ± kurulamadÄ±.');
        }
    };
</script>

</body>
</html>
