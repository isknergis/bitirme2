<!DOCTYPE html>
<html>

<head>
    <title>Sentisec Prototip</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            background: #eceff1;
        }

        .box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: auto;
        }

        textarea {
            width: 100%;
            height: 120px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
            outline: none;
            transition: 0.3s;
        }

        textarea:focus {
            border-color: #2196F3;
        }

        .meter-container {
            margin-top: 20px;
            background: #ddd;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
        }

        #riskBar {
            height: 100%;
            width: 0%;
            background: #4caf50;
            transition: 0.5s;
        }

        #status {
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="box">
        <h2>üõ°Ô∏è Sentisec Analiz Paneli</h2>
        <p>Mesajƒ±nƒ±zƒ± yazarken sistem arka planda analiz yapar:</p>
        <textarea id="textInput" placeholder="Buraya yazmaya ba≈ülayƒ±n..."></textarea>

        <div class="meter-container">
            <div id="riskBar"></div>
        </div>
        <div id="status">Durum: Bekleniyor...</div>
    </div>

    <script>
        let lastTime = Date.now();
        const input = document.getElementById('textInput');
        const bar = document.getElementById('riskBar');
        const status = document.getElementById('status');

        // This input event listener will fire every time the user types
        input.addEventListener('input', async () => {
            // 1. Hƒ±z √∂l√ß√ºm√º
            let now = Date.now();
            let timeDiff = now - lastTime;
            // Prevent division by zero or extremely high speeds on first character or fast typing
            if (timeDiff === 0) timeDiff = 1;

            // Calculate speed (characters per second roughly, logic from user)
            // Note: The logic "1000 / diff" gives instant speed for last char. 
            // It might be very high. app.py checks if hiz > 10.
            let speed = (1000 / timeDiff).toFixed(2);
            lastTime = now;

            // 2. Python'a (Backend) veri g√∂nderimi
            try {
                const response = await fetch('/analiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        speed: speed,
                        text: input.value
                    })
                });

                if (response.ok) {
                    const result = await response.json();

                    // 3. Aray√ºz√º g√ºncelle
                    // Ensure the width is a valid percentage string
                    let riskWidth = result.risk;
                    if (riskWidth > 100) riskWidth = 100;
                    bar.style.width = riskWidth + "%";

                    if (result.risk >= 100) {
                        bar.style.background = "#f44336"; // Kƒ±rmƒ±zƒ±
                        status.innerText = "DUR! Y√ºksek Risk Tespit Edildi!";
                        status.style.color = "red";
                    } else if (result.risk >= 50) {
                        bar.style.background = "#ff9800"; // Turuncu
                        status.innerText = "Dikkat: ≈û√ºpheli Hareket";
                        status.style.color = "orange";
                    } else {
                        bar.style.background = "#4caf50"; // Ye≈üil
                        status.innerText = "Durum: G√ºvenli Yazƒ±m";
                        status.style.color = "green";
                    }
                }
            } catch (error) {
                console.error("Analiz hatasƒ±:", error);
            }
        });
    </script>
</body>

</html>